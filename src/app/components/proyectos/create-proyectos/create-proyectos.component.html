<div class="container mt-5">
 
    <form [formGroup]="form">
       
        <div class="row form-group "><figure class="text-center">
            <div class="mt-3"> <h1 class="display-6 text-primary">Crear Proyecto</h1></div></figure>
            <div class="pt-4 col input-group mb-3">
                <div class="input-group-prepend">
                    <label class="input-group-text" for="clientSelect">Cliente</label>
                </div>
                <select formControlName="clientSelect" class="form-control form-select" id="clientSelect" #clientSelect
                    (change)="onSelected(clientSelect.value)">
                    <option value="none" selected disabled>Select an Option</option>
                    <option *ngFor="let client of clients" [value]="client.id">
                        {{client.nombre}} {{client.apellidos}}
                    </option>
                </select>
            </div>
            <div class="pt-4 col right-section input-group mb-3" *ngIf="clientSelect.value">
                <div class="input-group-prepend">
                    <label class="input-group-text" for="clientType">Tipo Cliente</label>
                </div>

                <select formControlName="clientType" class="form-control form-select" id="clientType">
                    <option value="none" selected disabled>Select an Option</option>
                    <option value="1"> Comercial</option>
                    <option value="2"> Residencial</option>
                </select>
            </div>
            <div class="pt-4 col right-section input-group mb-3" *ngIf="clientSelect.value">
                <div class="input-group-prepend">
                    <label class="input-group-text" for="projecType">Tipo de proyecto</label>
                </div>
                <select formControlName="projecType" class="form-control form-select" id="clientType">
                    <option value="none" selected disabled>Select an Option</option>
                    <option value="1"> Nueva construccion</option>
                    <option value="2"> Servicio</option>
                </select>
            </div>
        </div>

        <div *ngIf="totalP > 0" class="alert alert-success text-center">
            Total Proyecto: <h5 class="fw-bold">{{totalP |currency}}</h5>
        </div>

        <div *ngIf="clientSelect.value">
            <div class="row pt-3">
                <div class="col left-section">
                    <div class="card">
                        <div class="card-header text-center text-info fw-bold">
                            Materiales disponibles
                        </div>
                    </div>
                    <div *ngFor="let material of materials">
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                            <span class="fw-bold text-info">{{material.nombre}}</span>
                            <span class="text-muted fw-bold">{{material.precio | currency}}</span>
                            <button (click)="addMaterial(material)" class="btn btn-primary float-end btn-sm">Add to
                                cart</button></li>
                            </ul>
                    </div>
                </div>
                <div class="col right-section">
                    <div class="card" *ngIf="selectedMaterials.length > 0">
                        <div class="card-header text-center text-info fw-bold">
                            Materiales seleccionados
                        </div>
                    </div>
                    <div *ngFor="let selected of selectedMaterials" class="card">
                        <ul class="list-group">
                            <li class="list-group-item d-flex  align-items-start ">
                            <span class="fw-bold text-info input-group">{{selected.nombre}}</span>
                            <span class="text-muted fw-bold input-group">{{selected.precio |currency}}</span>
                            <div class="input-group input-group-sm mb-3">
                            <span class="input-group-text text-info">Cant</span> 
                             <input type="number" class="form-control" formControlName="quantity_{{selected.id}}" [(ngModel)]="selected.quantity"></div>
                         <span> <button (click)="removeMaterial(selected)"
                                class="btn btn-danger btn-sm ml-2 input-group float-end col">Remove</button></span> </li>
                        </ul>
                    </div>
                    <div *ngIf="selectedMaterials.length > 0" class="alert alert-success text-center">
                        Sub-Total Price Materiales: <span class="fw-bold">{{updateTotal() |currency}}</span>
                    </div>
                </div>
            </div>


            <div class="row pt-5">
                <div class="left-section col-6">
                    <div *ngIf="trabajadores.length <= 0" class="alert alert-success text-center">
                        <span class="font-weight-bold">No hay trabajadores Disponibles</span>
                    </div>

                    <div class="card" *ngIf="trabajadores.length > 0">

                        <div class="card-header text-center text-info fw-bold">
                            Trabajadores disponibles <span class="badge rounded-pill bg-warning">{{trabajadores.length}}</span>
                        </div>

                        <ul class="list-group list-group-item" *ngFor="let trabajador of trabajadores">
                            <li class="list-group-item row-cols" (click)="selectTrabajador(trabajador)">
                                <span class="card-title fw-bold">{{trabajador.nombre }} {{trabajador.apellidos }} 
                                    <i class="fas fa-plus-circle fa-lg text-info float-end"></i>
                                </span>
                            </li>
                        </ul>
                    </div>
                </div>


                <div class="col-6" *ngIf="selectedTrabajadores.length > 0">
                    <div class="card">
                        <div class="card-header text-center text-info fw-bold">
                            Trabajadores seleccionados <span class="badge rounded-pill bg-success">{{selectedTrabajadores.length}}</span>
                        </div>
                        <div *ngFor="let selectedTrabajador of selectedTrabajadores; let i = index">
                            <ul class="list-group">
                                <li class="list-group-item d-flex justify-content-between align-items-start">                             
                                    <div class="input-group col fw-bold text-info" (click)="unselectTrabajador(selectedTrabajador)">
                                        <span><i class="fas fa-minus-circle fa-lg text-danger m-2"></i></span>{{
                                        selectedTrabajador.nombre }} {{selectedTrabajador.apellidos }}</div>
                      
                                <div class="input-group col">  
                                    <span class="input-group-text text-info">Horas</span>  
                                        <input class="col-3 form-control" formControlName="horas" type="number" placeholder="C/horas" 
                                        [formControl]="selectedTrabajadores[i].form.get('horas')"
                                        (input)="updateSubtotal(selectedTrabajador)">
                                                                   
                                    
                                </div>
                                <div class="input-group col"> 
                                    <span class="input-group-text text-info">$/Hora</span>                                   
                                    <input formControlName="precioHora" type="number" class="col-3 form-control"
                                        [formControl]="selectedTrabajadores[i].form.get('precioHora')"
                                        (input)="updateSubtotal(selectedTrabajador) " placeholder="$/hora">
                                </div>
                              
                                <div class="input-group col fw-bold text-muted form-control">Subtotal: {{ selectedTrabajador.subtotal | currency}}</div></li>
                            </ul>
                        </div>
                    </div>
                    <div *ngIf="selectedTrabajadores.length > 0" class="alert alert-success text-center">
                        Sub-Total Trabajadores: <span class="fw-bold"> {{totalT | currency}}</span>
                    </div>
                </div>

            </div>
        </div>
    </form>
</div>